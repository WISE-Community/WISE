{"version":3,"sources":["src/main/webapp/wise5/components/summary/summaryController.es6"],"names":["SummaryController","$filter","$mdDialog","$rootScope","$scope","AnnotationService","ConfigService","NodeService","NotebookService","ProjectService","StudentAssetService","StudentDataService","SummaryService","UtilService","summaryNodeId","componentContent","summaryComponentId","studentDataType","chartType","prompt","highlightCorrectAnswer","warningMessage","showPromptFromOtherComponent","otherPrompt","getOtherPrompt","isStudent","isPreview","isStudentRun","otherStepTitle","getOtherStepTitle","isShowDisplay","calculateIsShowDisplay","getWarningMessage","setPeriodIdIfNecessary","nodeId","componentId","otherComponent","getComponentByNodeIdAndComponentId","componentStates","getComponentStatesByNodeIdAndComponentId","length","requirementToSeeSummary","studentHasSubmittedWork","studentHasCompletedComponent","messageTranslationKey","$translate","stepTitle","componentState","isSubmit","isCompleted","getNodePositionAndTitleByNodeId","source","periodId","getPeriodId","event","args","ComponentController","$inject"],"mappings":"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","sourcesContent":["'use strict';\r\n\r\nimport ComponentController from '../componentController';\r\n\r\nclass SummaryController extends ComponentController {\r\n  constructor($filter,\r\n      $mdDialog,\r\n      $rootScope,\r\n      $scope,\r\n      AnnotationService,\r\n      ConfigService,\r\n      NodeService,\r\n      NotebookService,\r\n      ProjectService,\r\n      StudentAssetService,\r\n      StudentDataService,\r\n      SummaryService,\r\n      UtilService) {\r\n    super($filter,\r\n        $mdDialog,\r\n        $rootScope,\r\n        $scope,\r\n        AnnotationService,\r\n        ConfigService,\r\n        NodeService,\r\n        NotebookService,\r\n        ProjectService,\r\n        StudentAssetService,\r\n        StudentDataService,\r\n        UtilService);\r\n    this.SummaryService = SummaryService;\r\n    this.summaryNodeId = this.componentContent.summaryNodeId;\r\n    this.summaryComponentId = this.componentContent.summaryComponentId;\r\n    this.studentDataType = this.componentContent.studentDataType;\r\n    this.chartType = this.componentContent.chartType;\r\n    this.prompt = this.componentContent.prompt;\r\n    this.highlightCorrectAnswer = this.componentContent.highlightCorrectAnswer;\r\n    this.warningMessage = '';\r\n    if (this.componentContent.showPromptFromOtherComponent) {\r\n      this.otherPrompt = this.getOtherPrompt(this.summaryNodeId, this.summaryComponentId);\r\n    }\r\n    this.isStudent = this.ConfigService.isPreview() || this.ConfigService.isStudentRun();\r\n    if (this.isStudent) {\r\n      this.otherStepTitle = this.getOtherStepTitle();\r\n      this.isShowDisplay = this.calculateIsShowDisplay();\r\n    } else {\r\n      this.isShowDisplay = true;\r\n    }\r\n    if (!this.isShowDisplay) {\r\n      this.warningMessage = this.getWarningMessage();\r\n    }\r\n    this.setPeriodIdIfNecessary();\r\n  }\r\n\r\n  getOtherPrompt(nodeId, componentId) {\r\n    const otherComponent = this.ProjectService.getComponentByNodeIdAndComponentId(\r\n        nodeId, componentId);\r\n    if (otherComponent != null) {\r\n      return otherComponent.prompt;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  isStudentHasWork() {\r\n    const componentStates = this.StudentDataService.getComponentStatesByNodeIdAndComponentId(\r\n        this.summaryNodeId, this.summaryComponentId);\r\n    return componentStates.length > 0;\r\n  }\r\n\r\n  calculateIsShowDisplay() {\r\n    if (this.componentContent.requirementToSeeSummary === 'submitWork') {\r\n      return this.studentHasSubmittedWork();\r\n    } else if (this.componentContent.requirementToSeeSummary === 'completeComponent') {\r\n      return this.studentHasCompletedComponent();\r\n    } else if (this.componentContent.requirementToSeeSummary === 'none') {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  getWarningMessage() {\r\n    let messageTranslationKey = '';\r\n    if (this.componentContent.requirementToSeeSummary === 'submitWork') {\r\n      messageTranslationKey = 'summary.youMustSubmitWork';\r\n    } else if (this.componentContent.requirementToSeeSummary === 'completeComponent') {\r\n      messageTranslationKey = 'summary.youMustComplete';\r\n    }\r\n    return this.$translate(messageTranslationKey, { stepTitle: this.otherStepTitle });\r\n  }\r\n\r\n  studentHasSubmittedWork() {\r\n    const componentStates = this.StudentDataService.getComponentStatesByNodeIdAndComponentId(\r\n        this.summaryNodeId, this.summaryComponentId); \r\n    for (const componentState of componentStates) {\r\n      if (componentState.isSubmit) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  studentHasSavedWork() {\r\n    const componentStates = this.StudentDataService.getComponentStatesByNodeIdAndComponentId(\r\n        this.summaryNodeId, this.summaryComponentId); \r\n    return componentStates.length > 0;\r\n  }\r\n\r\n  studentHasCompletedComponent() {\r\n    return this.StudentDataService.isCompleted(this.summaryNodeId, this.summaryComponentId);\r\n  }\r\n\r\n  getOtherStepTitle() {\r\n    return this.ProjectService.getNodePositionAndTitleByNodeId(this.summaryNodeId);\r\n  }\r\n\r\n  setPeriodIdIfNecessary() {\r\n    if (this.ConfigService.isStudentRun()) {\r\n      if (this.componentContent.source === 'period') {\r\n        this.periodId = this.ConfigService.getPeriodId();\r\n      } else if (this.componentContent.source === 'allPeriods') {\r\n        this.periodId = null;\r\n      }\r\n    }\r\n  }\r\n\r\n  handleStudentWorkSavedToServerAdditionalProcessing(event, args) {\r\n    if (this.isStudent) {\r\n      this.isShowDisplay = this.calculateIsShowDisplay();\r\n    }\r\n  }\r\n}\r\n\r\nSummaryController.$inject = [\r\n    '$filter',\r\n    '$mdDialog',\r\n    '$rootScope',\r\n    '$scope',\r\n    'AnnotationService',\r\n    'ConfigService',\r\n    'NodeService',\r\n    'NotebookService',\r\n    'ProjectService',\r\n    'StudentAssetService',\r\n    'StudentDataService',\r\n    'SummaryService',\r\n    'UtilService'\r\n];\r\n\r\nexport default SummaryController;\r\n"],"file":"summaryController.js"}