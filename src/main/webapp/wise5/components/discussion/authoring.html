<div>
    <div class='advancedAuthoringDiv'
         ng-if='discussionController.showAdvancedAuthoring'>
    <div>
      <h6>{{ ::'advancedAuthoringOptions' | translate }}</h6>
    </div>
    <div layout="column" layout-align="start start">
      <edit-component-max-score [authoring-component-content]="discussionController.authoringComponentContent"></edit-component-max-score>
      <edit-component-width [authoring-component-content]="discussionController.authoringComponentContent"></edit-component-width>
      <edit-component-rubric [authoring-component-content]="discussionController.authoringComponentContent"></edit-component-rubric>
      <edit-component-tags [authoring-component-content]="discussionController.authoringComponentContent"></edit-component-tags>
    </div>
    <div>
      <div style='height: 50;'>
        <label class='node__label--vertical-alignment'>
          {{ ::'CONNECTED_COMPONENTS' | translate }}
        </label>
        <md-button class='topButton md-raised md-primary'
                    ng-click='discussionController.addConnectedComponent()'>
          <md-icon>add</md-icon>
          <md-tooltip md-direction='top'
                      class='projectButtonTooltip'>
            {{ ::'ADD_CONNECTED_COMPONENT' | translate }}
          </md-tooltip>
        </md-button>
      </div>
      <div ng-repeat='connectedComponent in discussionController.authoringComponentContent.connectedComponents track by $index'
            style='border: 2px solid #dddddd; border-radius: 5px; margin-bottom: 10px; padding: 20px 20px 10px 20px;'
            layout='row'>
        <div flex>
          <md-input-container style='margin-right: 20; width: 300;'>
            <label>{{ ::'step' | translate }}</label>
            <md-select ng-model='connectedComponent.nodeId'
                        ng-change='discussionController.connectedComponentNodeIdChanged(connectedComponent)'
                        style='width: 300'>
              <md-option ng-repeat='item in discussionController.idToOrder | toArray | orderBy : "order"'
                          value='{{item.$key}}'
                          ng-if='discussionController.isApplicationNode(item.$key)'>
                {{ discussionController.getNodePositionAndTitleByNodeId(item.$key) }}
              </md-option>
            </md-select>
          </md-input-container>
          <md-input-container style='margin-right: 20; width: 300;'>
            <label>{{ ::'component' | translate }}</label>
            <md-select ng-model='connectedComponent.componentId'
                        ng-change='discussionController.connectedComponentComponentIdChanged(connectedComponent)'
                        style='width: 300'>
              <md-option ng-repeat='(componentIndex, component) in discussionController.getComponentsByNodeId(connectedComponent.nodeId)'
                          value='{{component.id}}'
                          ng-disabled='!discussionController.isConnectedComponentTypeAllowed(component.type) || component.id == discussionController.componentId'>
                {{ componentIndex + 1 }}. {{ component.type }}
                <span ng-if='component.id == discussionController.componentId'>
                  ({{ ::'thisComponent' | translate }})
                </span>
              </md-option>
            </md-select>
          </md-input-container>
          <md-input-container style='margin-right: 20; width: 200;'>
            <label>{{ 'type' | translate }}</label>
            <md-select ng-model='connectedComponent.type'
                        ng-change='discussionController.connectedComponentTypeChanged(connectedComponent)'
                        style='width: 200'>
              <md-option value='importWork'>
                {{ ::'importWork' | translate }}
              </md-option>
              <md-option value='showWork'>
                {{ ::'showWork' | translate }}
              </md-option>
            </md-select>
          </md-input-container>
          <span flex></span>
          <md-input-container style='margin-left: 20;'>
            <md-button class='topButton md-raised md-primary'
                        ng-click='discussionController.deleteConnectedComponent($index)'>
              <md-icon>delete</md-icon>
              <md-tooltip md-direction='top'
                          class='projectButtonTooltip'>
                {{ ::'DELETE' | translate }}
              </md-tooltip>
            </md-button>
          </md-input-container>
        </div>
      </div>
    </div>
    <edit-component-json [node-id]="discussionController.nodeId" [component-id]="discussionController.componentId"></edit-component-json>
  </div>
  <br/>
  <div ng-if='!discussionController.authoringComponentContent.showPreviousWork'>
    <md-input-container style='width: 100%; margin-bottom: 0;'>
      <label>{{ ::'PROMPT' | translate }}</label>
      <textarea rows='1'
                ng-model='discussionController.authoringComponentContent.prompt'
                ng-change='discussionController.authoringViewComponentChanged()'
                ng-model-options='{ debounce: 1000 }'
                placeholder='{{ ::"enterPromptHere" | translate }}'>
    </textarea>
    </md-input-container>
    <md-input-container style='margin-top: 0; margin-bottom: 0;'>
      <md-checkbox class='md-primary'
                    ng-model='discussionController.authoringComponentContent.isStudentAttachmentEnabled'
                    ng-change='discussionController.authoringViewComponentChanged()'>
        {{ ::'discussion.allowUploadedImagesInPosts' | translate }}
      </md-checkbox>
    </md-input-container>
    <br/>
    <md-input-container style='margin-top: 0; margin-bottom: 0;'>
      <md-checkbox class='md-primary'
                   ng-model='discussionController.authoringComponentContent.gateClassmateResponses'
                   ng-change='discussionController.authoringViewComponentChanged()'>
        {{ ::'discussion.gateClassmateResponses' | translate }}
      </md-checkbox>
    </md-input-container>
  </div>
  <div ng-style='{"border": "5px solid black", "padding": "20px"}'>
    <div>
      <h5>{{ ::'studentPreview' | translate }}</h5>
    </div>
    <preview-component component-content='discussionController.componentContent'/>
  </div>
</div>
